<!DOCTYPE html>
<html>
<head>
	<title>Test Sender</title>
	<style>
		.position {
			display:none;
		}
	</style>

</head>
<body>

	<div>
		<h1>Search</h1>
		<form name="search-form" onsubmit="return checkSearch()" method="post" action=""> <!--checkSearch.php">-->
			<p>
				<input type="text" name="position" id="position" placeholder="Position" class="position">
			</p>
			<h4>
				distance
			</h4>
			<input type="range" min="5" max="50" value="10" step="5" onchange="showValue(this.value)" value="15" />
			<span id="range">10 km</span>
			
			<h4>
				eventi
			</h4>
			<table>
				<tr>
					<td>
						<input type="checkbox" name="party" id="party" value="1">
						festa
					</td>
					<td>
						<input type="checkbox" name="show" id="show" value="1">
						spettacolo
					</td>
				</tr>
				<tr>
					<td>
						<input type="checkbox" name="art" id="art" value="1">
						mostra
					</td>
					<td>
						<input type="checkbox" name="sport" id="sport" value="1">
						sport
					</td>
				</tr>
			</table>
			
			<p>
				<button type="submit">
					Search
				</button>
			</p>			
		</form>
		<div id="test">
			test
		</div>
		<button onclick="getLocation()">
			position
		</button>
		<div id="map" style="width:100%;height:500px"></div>
	</div>

	<div>
		<h1>Login</h1>
		<form name="login-form" onsubmit="return checkLogin()" method="post" action="checkLogin.php">
			<p>
				<input type="text" name="loginUsername" id="loginUsername" placeholder="Username" >
			</p>
			<p>
				<input type="password" name="loginPassword" id="loginPassword" placeholder="Password">
			</p>
			<p>
				<button type="submit">
					accedi
				</button>
			</p>
			
		</form>
	</div>

	<div>
		<h1>Registration</h1>
		<form name="register-form" onsubmit="return checkReg()" method="post" action="checkReg.php">
			<p>
				<input type="text" name="regUsername" id="regUsername" placeholder="Username" >
			</p>
			<p>
				<input type="mail" name="mail1" id="mail1" placeholder="Mail" >
			</p>
			<p>
				<input type="mail" name="mail2" id="mail2" placeholder="Repeat Mail" >
			</p>
			<p>
				<input type="password" name="password1" id="password1" placeholder="Password" >
			</p>
			<p>
				<input type="password" name="password2" id="password2" placeholder="Repeat Password">
			</p>
			<p>
				<button type="submit">
					Register
				</button>
			</p>
		</form>
	</div>


	<script type="text/javascript">

		function checkLogin() {
			alert("check login");
			if(document.getElementById("loginUsername").value == "") {
				document.getElementById("loginUsername").focus();
				return false;
			}
			if(document.getElementById("loginPassword").value == "") {
				document.getElementById("loginPassword").focus();
				return false;
			}
			return true;
		}

		function checkReg() {
			alert("check reg");
			//non funziona test mail valida
			var pattern = new RegExp("[^[a-zA-Z0-9_]+@[a-zA-Z0-9\-]+\.[a-zA-Z0-9\-\.]+$]]");

			if(document.getElementById("regUsername").value == "") {
				document.getElementById("regUsername").focus();
				return false;
			}
			if(document.getElementById("mail1").value == "" || pattern.test(document.getElementById("mail1").value)) {
				document.getElementById("mail1").focus();
				return false;
			}
			if(document.getElementById("mail2").value == "" || document.getElementById("mail1").value != document.getElementById("mail2").value) {
				document.getElementById("mail2").focus();
				return false;
			}
			if(document.getElementById("password1").value == "") {
				document.getElementById("password1").focus();
				return false;
			}

			if(document.getElementById("password2").value == "" || document.getElementById("password1").value != document.getElementById("password2").value) {
				document.getElementById("password2").focus();
				return false;
			}
			return true;
		}

		function showValue(newValue)
		{
		  document.getElementById("range").innerHTML=newValue+" km";
		}

		var first = 0;
		function checkSearch() {
			alert("check search");
			if(first == 0) {
				first++;
				document.getElementById("position").style.display.value = "block";
				getLocation();
			} else {
				if(document.getElementById("position").value == "") {
					document.getElementById("position").focus();
					return false;
				}
				return true;
			}
		}

		var x = document.getElementById("test");
		function getLocation() {
		    if (navigator.geolocation) {
		        navigator.geolocation.getCurrentPosition(showPosition, showError);
		    } else {
		        x.innerHTML = "Geolocation is not supported by this browser.";
		    }
		}

		function showPosition(position) {
			//test
			var locations = [
				['You Are Here', position.coords.latitude, position.coords.longitude, 1],
				['Bondi Beach', position.coords.latitude+0.0001, position.coords.longitude+0.0001, 4],
				['Coogee Beach', position.coords.latitude+0.0002, position.coords.longitude+0.0002, 5],
				['Cronulla Beach', position.coords.latitude-0.0001, position.coords.longitude-0.0001, 3],
				['Manly Beach', position.coords.latitude-0.0002, position.coords.longitude-0.0002, 2]
			];

			var map = new google.maps.Map(document.getElementById('map'), {
			      zoom: 17,
			      center: new google.maps.LatLng(position.coords.latitude, position.coords.longitude),
			      mapTypeId: google.maps.MapTypeId.ROADMAP
			    });

			    var infowindow = new google.maps.InfoWindow();

			    var marker, i;

			   var sog = new google.maps.Marker({
			        position: new google.maps.LatLng(locations[0][1], locations[0][2]),
			        animation:google.maps.Animation.BOUNCE,
			        map: map
			      });
			    google.maps.event.addListener(sog, 'click', (function(sog, i) {
			        return function() {
			          infowindow.setContent(locations[0][0]);
			          infowindow.open(map, sog);
			        }
			      })(sog, i));

			    for (i = 1; i < locations.length; i++) {  
			      marker = new google.maps.Marker({
			        position: new google.maps.LatLng(locations[i][1], locations[i][2]),
			        map: map
			      });

			      google.maps.event.addListener(marker, 'click', (function(marker, i) {
			        return function() {
			          infowindow.setContent(locations[i][0]);
			          infowindow.open(map, marker);
			        }
			      })(marker, i));
			    }

			//funge
		    /*var myCenter = new google.maps.LatLng(position.coords.latitude,position.coords.longitude);
			var mapCanvas = document.getElementById("map");
			var mapOptions = {center: myCenter, zoom: 15};
			var map = new google.maps.Map(mapCanvas, mapOptions);
			var marker = new google.maps.Marker({
				position:myCenter,
				animation:google.maps.Animation.BOUNCE
			});
			marker.setMap(map);*/
		}
		
		function showError(error) {
			alert("show error: "+error.code);
		    switch(error.code) {
		        case error.PERMISSION_DENIED:
		            x.innerHTML = "User denied the request for Geolocation."
		            break;
		        case error.POSITION_UNAVAILABLE:
		            x.innerHTML = "Location information is unavailable."
		            break;
		        case error.TIMEOUT:
		            x.innerHTML = "The request to get user location timed out."
		            break;
		        case error.UNKNOWN_ERROR:
		            x.innerHTML = "An unknown error occurred."
		            break;
		    }
		}
	</script>
	<script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyAQO1FBU7ngY0Wv20d3-gPI1sj5_ApCZ3M"></script>

</body>
</html>